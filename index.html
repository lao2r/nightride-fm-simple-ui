<html><head><base href="https://nightride.fm/">
<title>Synthwave Radio - NightRide.fm</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'Orbitron', sans-serif;
    background-color: #171615;
    color: #beb6a9;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .container {
    position: relative;
    width: 100%;
    max-width: 800px;
    height: 600px;
    border-radius: 10px;
    box-shadow: 0 0 20px;
    overflow: hidden;
  }

  .overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .overlay.noise {
    z-index: 800;
    animation: grain 8s steps(10) infinite;
    background-image: url(https://nightride.fm/static/img/noise.png);
    height: 400%;
    left: -50%;
    top: -150%;
    width: 300%;
    background-size: auto;
    opacity: .2;
  }

  .overlay.scanline {
    z-index: 1010;
    animation: scanline 7.77s linear infinite;
    background: linear-gradient(to bottom,
                transparent 80%,
                rgba(0, 0, 0, 0.3) 90%);
    background-size: 100% 4px;
	background-repeat: repeat-x;
  }

  @keyframes grain {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(-5%, -10%); }
    20% { transform: translate(-15%, 5%); }
    30% { transform: translate(7%, -25%); }
    40% { transform: translate(-5%, 25%); }
    50% { transform: translate(-15%, 10%); }
    60% { transform: translate(15%, 0%); }
    70% { transform: translate(0%, 15%); }
    80% { transform: translate(3%, 35%); }
    90% { transform: translate(-10%, 10%); }
  }

  @keyframes scanline {
    100% { transform: translateY(0); }
    0% { transform: translateY(100%); }
  }

   .logo {
       position: absolute;
       top: 20px;
       left: 20px;
       font-size: 24px;
       text-shadow: 0 0 10px;
   }

   .controls {
       position: absolute;
       top: 20px;
       left: 50%;
       transform: translateX(-50%);
       display: flex;
       align-items: center;
       height: 40px;
   }

   .btn {
       background: none;
       border: none;
       font-size: 24px;
       cursor: pointer;
       margin: 0 10px;
       transition: all 0.3s ease;
       width: 30px;
   }

  .btn:hover {
    text-shadow: 0 0 10px;
  }

   .volume-bar {
       width: 100px;
       left: 10;
       height: 5px;
       position: relative;
       border-radius: 5px;
       overflow: hidden;
   }

  .volume-level {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 50%;
      box-shadow: 0 0 10px;
  }

  #status {
      position: absolute;
      top: 60px;
      left: 20px;
      text-shadow: 0 0 black;
      font-size: 14px;
  }

  #currentInfo {
      position: absolute;
      top: 80px;
      left: 20px;
      text-shadow: 0 0 black;
      font-size: 14px;
  }

  canvas {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
  }

  #frequencyCanvas {
    top: 50%;
    transform: translateY(-50%);
  }

  .style-buttons {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    width: 90%;
  }

  .style-btn {
    background: #00000075;
    border: 1px solid;
    font-size: 12px;
    cursor: pointer;
    margin: 5px;
    padding: 5px 10px;
    border-radius: 15px;
    transition: all 0.3s ease;
  }

  .style-btn:hover, .style-btn.active {
    color: #171615;
  }

  /* Chillsynth - unchanged */
  body.chillsynth { background-color: #171615; color: #beb6a9; }
  .chillsynth .container { background: linear-gradient(45deg, #3a1c3d, #251320); border: 2px solid #a923c2; box-shadow: 0 0 20px #e02cd2; }
  .chillsynth .logo { color: #d8faf2; text-shadow: 0 0 10px #84e7ff; }
  .chillsynth .btn { color: #d8faf2; }
  .chillsynth .btn:hover { text-shadow: 0 0 10px #e02cd2; }
  .chillsynth .volume-bar { background: #435155; }
  .chillsynth .volume-level { background: linear-gradient(90deg, #a923c2, #e02cd2); box-shadow: 0 0 10px #e02cd2; }
  .chillsynth #currentInfo { color: #e02cd2; }
  .chillsynth .style-btn { border-color: #a923c2; color: #d8faf2; }
  .chillsynth .style-btn:hover, .chillsynth .style-btn.active { background-color: #a923c2; }

  /* Nightride - Blade Runner inspired */
  body.nightride { background-color: #0d0e16; color: #66fcf1; }
  .nightride .container { background: linear-gradient(45deg, #1f2833, #0b0c10); border: 2px solid #45a29e; box-shadow: 0 0 20px #66fcf1; }
  .nightride .logo { color: #66fcf1; text-shadow: 0 0 10px #45a29e; }
  .nightride .btn { color: #66fcf1; }
  .nightride .btn:hover { text-shadow: 0 0 10px #45a29e; }
  .nightride .volume-bar { background: #1f2833; }
  .nightride .volume-level { background: linear-gradient(90deg, #45a29e, #66fcf1); box-shadow: 0 0 10px #66fcf1; }
  .nightride #currentInfo { color: #45a29e; }
  .nightride .style-btn { border-color: #45a29e; color: #66fcf1; }
  .nightride .style-btn:hover, .nightride .style-btn.active { background-color: #45a29e; }

  /* Datawave - 80s Computer Terminal */
  body.datawave { background-color: #000000; color: #00ff00; }
  .datawave .container { background: linear-gradient(45deg, #001100, #002200); border: 2px solid #00ff00; box-shadow: 0 0 20px #00ff00; }
  .datawave .logo { color: #00ff00; text-shadow: 0 0 10px #00aa00; }
  .datawave .btn { color: #00ff00; }
  .datawave .btn:hover { text-shadow: 0 0 10px #00aa00; }
  .datawave .volume-bar { background: #001100; }
  .datawave .volume-level { background: linear-gradient(90deg, #00aa00, #00ff00); box-shadow: 0 0 10px #00ff00; }
  .datawave #currentInfo { color: #00aa00; }
  .datawave .style-btn { border-color: #00aa00; color: #00ff00; }
  .datawave .style-btn:hover, .datawave .style-btn.active { background-color: #00aa00; }

  /* Spacesynth - 80s Sci-Fi */
  body.spacesynth { background-color: #0c0b13; color: #e762d7; }
  .spacesynth .container { background: linear-gradient(45deg, #1e1637, #0c0b13); border: 2px solid #e762d7; box-shadow: 0 0 20px #b52cc7; }
  .spacesynth .logo { color: #e762d7; text-shadow: 0 0 10px #b52cc7; }
  .spacesynth .btn { color: #e762d7; }
  .spacesynth .btn:hover { text-shadow: 0 0 10px #b52cc7; }
  .spacesynth .volume-bar { background: #1e1637; }
  .spacesynth .volume-level { background: linear-gradient(90deg, #b52cc7, #e762d7); box-shadow: 0 0 10px #e762d7; }
  .spacesynth #currentInfo { color: #b52cc7; }
  .spacesynth .style-btn { border-color: #b52cc7; color: #e762d7; }
  .spacesynth .style-btn:hover, .spacesynth .style-btn.active { background-color: #b52cc7; }

  /* Darksynth - Terminator inspired */
  body.darksynth { background-color: #1a1a1a; color: #ff3c00; }
  .darksynth .container { background: linear-gradient(45deg, #2b2b2b, #1a1a1a); border: 2px solid #ff3c00; box-shadow: 0 0 20px #ff3c00; }
  .darksynth .logo { color: #ff3c00; text-shadow: 0 0 10px #b32900; }
  .darksynth .btn { color: #ff3c00; }
  .darksynth .btn:hover { text-shadow: 0 0 10px #b32900; }
  .darksynth .volume-bar { background: #2b2b2b; }
  .darksynth .volume-level { background: linear-gradient(90deg, #b32900, #ff3c00); box-shadow: 0 0 10px #ff3c00; }
  .darksynth #currentInfo { color: #b32900; }
  .darksynth .style-btn { border-color: #b32900; color: #ff3c00; }
  .darksynth .style-btn:hover, .darksynth .style-btn.active { background-color: #b32900; }

  /* Horrorsynth - 80s Horror */
  body.horrorsynth { background-color: #000000; color: #ff0000; }
  .horrorsynth .container { background: linear-gradient(45deg, #1a0000, #000000); border: 2px solid #ff0000; box-shadow: 0 0 20px #800000; }
  .horrorsynth .logo { color: #ff0000; text-shadow: 0 0 10px #800000; }
  .horrorsynth .btn { color: #ff0000; }
  .horrorsynth .btn:hover { text-shadow: 0 0 10px #800000; }
  .horrorsynth .volume-bar { background: #1a0000; }
  .horrorsynth .volume-level { background: linear-gradient(90deg, #800000, #ff0000); box-shadow: 0 0 10px #ff0000; }
  .horrorsynth #currentInfo { color: #800000; }
  .horrorsynth .style-btn { border-color: #800000; color: #ff0000; }
  .horrorsynth .style-btn:hover, .horrorsynth .style-btn.active { background-color: #800000; }

  /* EBSM - 90s Electronica */
  body.ebsm { background-color: #000033; color: #00ffff; }
  .ebsm .container { background: linear-gradient(45deg, #000066, #000033); border: 2px solid #00ffff; box-shadow: 0 0 20px #0080ff; }
  .ebsm .logo { color: #00ffff; text-shadow: 0 0 10px #0080ff; }
  .ebsm .btn { color: #00ffff; }
  .ebsm .btn:hover { text-shadow: 0 0 10px #0080ff; }
  .ebsm .volume-bar { background: #000066; }
  .ebsm .volume-level { background: linear-gradient(90deg, #0080ff, #00ffff); box-shadow: 0 0 10px #00ffff; }
  .ebsm #currentInfo { color: #0080ff; }
  .ebsm .style-btn { border-color: #0080ff; color: #00ffff; }
  .ebsm .style-btn:hover, .ebsm .style-btn.active { background-color: #0080ff; }
</style>
</head>
<body class="chillsynth">
  <div class="container">
    <div class="overlay noise"></div>
	<div class="overlay scanlines __web-inspector-hide-shortcut__"></div>
    <div class="overlay scanline"></div>
    <div class="logo"><a href="https://nightride.fm" style="color: inherit; text-decoration: none;">NIGHTRIDE.FM</a></div>
    <div id="status">Ready to play</div>
    <div id="currentInfo"></div>
    <canvas id="frequencyCanvas"></canvas>
    <canvas id="barsCanvas"></canvas>
    <div class="controls" style="top: 40px;">
  <button id="playBtn" class="btn">▶</button>
  <button id="muteBtn" class="btn">♫</button>
  <div class="volume-bar" style="cursor: pointer;">
    <div class="volume-level"></div>
  </div>
</div>
    <div class="style-buttons">
      <button class="style-btn" data-style="nightride">NIGHTRIDE</button>
      <button class="style-btn active" data-style="chillsynth">CHILLSYNTH</button>
      <button class="style-btn" data-style="datawave">DATAWAVE</button>
      <button class="style-btn" data-style="spacesynth">SPACESYNTH</button>
      <button class="style-btn" data-style="darksynth">DARKSYNTH</button>
      <button class="style-btn" data-style="horrorsynth">HORRORSYNTH</button>
      <button class="style-btn" data-style="ebsm">EBSM</button>
    </div>
  </div>

  <script>
    let audioElement;
    let playing = false;
    let audioContext;
    let analyser;
    let isMuted = false;
    let animationId;
    let currentStyle = 'chillsynth';
    let metaInfo = {};

    const playBtn = document.getElementById('playBtn');
    const muteBtn = document.getElementById('muteBtn');
    const status = document.getElementById('status');
    const currentInfo = document.getElementById('currentInfo');
    const volumeControl = document.querySelector('.volume-level');
    const frequencyCanvas = document.getElementById('frequencyCanvas');
    const barsCanvas = document.getElementById('barsCanvas');
    const styleButtons = document.querySelectorAll('.style-btn');
    
    // Default volume to 50%
    let defaultVolume = 0.5;

    playBtn.addEventListener('click', togglePlay);
    muteBtn.addEventListener('click', toggleMute);
    volumeControl.parentElement.addEventListener('click', adjustVolume);

    styleButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const newStyle = e.target.dataset.style;
        if (newStyle !== currentStyle) {
          document.body.className = newStyle; // Меняем цветовую схему сразу
          currentStyle = newStyle;
          styleButtons.forEach(btn => btn.classList.remove('active'));
          e.target.classList.add('active');
          updateVisualColors(); // Обновляем цвета визуализаторов
          if (playing) {
            stopAudio();
            playAudio();
          }
          updateCurrentInfo();
          updateButtonStyles(); // Обновляем стиль кнопок
        }
      });
    });

    const sseUrl = 'https://nightride.fm/meta';
    const eventSource = new EventSource(sseUrl);

    eventSource.onmessage = (event) => {
      if (event.data !== "keepalive") {
        const data = JSON.parse(event.data);
        data.forEach(item => {
          metaInfo[item.station] = item;
        });
        updateCurrentInfo();
      }
    };

    function updateCurrentInfo() {
      const currentMeta = metaInfo[currentStyle];
      if (currentMeta) {
        const { artist, title, album } = currentMeta;
        currentInfo.textContent = `${artist} - ${title} (${album})`;
      } else {
        currentInfo.textContent = 'Loading track information...';
      }
    }

    function togglePlay() {
      if (playing) {
        pauseAudio();
      } else {
        playAudio();
      }
    }

    function playAudio() {
      stopAudio();
      
      audioElement = new Audio(`https://stream.nightride.fm/${currentStyle}.mp3`);
      audioElement.crossOrigin = "anonymous";
      audioElement.volume = defaultVolume;
      
      status.textContent = 'Connecting...';
      
      audioElement.addEventListener('canplay', () => {
        status.textContent = 'Now playing';
        playing = true;
        playBtn.textContent = '❚❚';
        setupAudioContext();
      });

      audioElement.addEventListener('error', (e) => {
        status.textContent = 'Error: Unable to play audio';
        playing = false;
        playBtn.textContent = '▶';
      });

      audioElement.play().catch(error => {
        status.textContent = 'Error: Unable to play audio';
        playing = false;
        playBtn.textContent = '▶';
      });
    }

    function pauseAudio() {
      if (audioElement) {
        audioElement.pause();
        status.textContent = 'Paused';
        playing = false;
        playBtn.textContent = '▶';
      }
    }

    function stopAudio() {
      if (audioElement) {
        audioElement.pause();
        audioElement.src = '';
        audioElement.load();
        audioElement = null;
      }
      if (audioContext && audioContext.state !== 'closed') {
        audioContext.close().catch(error => {
          console.warn('Error closing AudioContext:', error);
        }).finally(() => {
          audioContext = null;
          analyser = null;
        });
      } else {
        audioContext = null;
        analyser = null;
      }
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      playing = false;
      playBtn.textContent = '▶';
    }

    function toggleMute() {
      if (audioElement) {
        audioElement.muted = !audioElement.muted;
        isMuted = audioElement.muted;
        muteBtn.textContent = isMuted ? '✖' : '♫';
      }
    }

    function adjustVolume(e) {
      const rect = volumeControl.parentElement.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const width = rect.width;
      const volume = Math.max(0, Math.min(1, x / width));
      
      if (audioElement) {
        audioElement.volume = volume;
        volumeControl.style.width = `${volume * 100}%`;
      }
      defaultVolume = volume;
    }

    function setupAudioContext() {
      if (audioContext && audioContext.state !== 'closed') {
        audioContext.close().catch(error => {
          console.warn('Error closing existing AudioContext:', error);
        });
      }
      
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      
      const source = audioContext.createMediaElementSource(audioElement);
      source.connect(analyser);
      analyser.connect(audioContext.destination);
      
      updateVisualizers();
    }

    function updateVisualizers() {
      drawFrequency();
      drawBars();
      animationId = requestAnimationFrame(updateVisualizers);
    }

    function drawFrequency() {
      const WIDTH = frequencyCanvas.width;
      const HEIGHT = frequencyCanvas.height;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      
      analyser.getByteFrequencyData(dataArray);
      const ctx = frequencyCanvas.getContext('2d');
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      
      ctx.lineWidth = 1;
      ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('color'); // Обновляем цвет
      ctx.beginPath();
      
      const sliceWidth = WIDTH * 1.0 / (bufferLength / 4);
      let x = 0;
      
      for (let i = 0; i < bufferLength; i++) {
        const v = dataArray[i] / 128.0;
        const y = v * HEIGHT / 2;
        
        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
        
        x += sliceWidth;
      }
      
      ctx.lineTo(WIDTH, HEIGHT / 2);
      ctx.stroke();
    }

    function drawBars() {
      const WIDTH = barsCanvas.width;
      const HEIGHT = barsCanvas.height;
      const bufferLength = analyser.frequencyBinCount / 8;
      const dataArray = new Uint8Array(bufferLength);
      
      analyser.getByteFrequencyData(dataArray);
      const ctx = barsCanvas.getContext('2d');
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      
      const barWidth = (WIDTH / bufferLength) * 2.5;
      let x = 0;
      
      const gradient = ctx.createLinearGradient(0, HEIGHT, 0, 0);
      gradient.addColorStop(0, getComputedStyle(document.body).getPropertyValue('color')); // Обновляем цвет
      gradient.addColorStop(1, getComputedStyle(document.querySelector('#currentInfo')).getPropertyValue('color')); // Обновляем цвет
      
      for (let i = 0; i < bufferLength; i++) {
        const barHeight = (dataArray[i] / 255) * HEIGHT;
        
        ctx.fillStyle = gradient;
        ctx.fillRect(x, HEIGHT - barHeight, barWidth, barHeight);
        
        x += barWidth + 1;
      }
    }

    function updateVisualColors() {
      drawFrequency();
      drawBars();
    }

    function updateButtonStyles() {
      styleButtons.forEach(button => {
        const style = button.dataset.style;
        if (style === currentStyle) {
          button.classList.add('active');
        } else {
          button.classList.remove('active');
        }
      });
    }

    // Set canvas sizes
    function resizeCanvas() {
      frequencyCanvas.width = frequencyCanvas.offsetWidth;
      frequencyCanvas.height = frequencyCanvas.offsetHeight;
      barsCanvas.width = barsCanvas.offsetWidth;
      barsCanvas.height = barsCanvas.offsetHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
  </script>
</body></html>
